<div class="status-item">Last Message: <span id="lastMessage">-</span></div>
    </div>
  </div>
  
  <footer class="footer">
    <p>©2025 Send From Web Using Cookies</p>
    <p>◉ All Rights Reserved ◉</p>
    <p>Owner: majnu X rahat ✷</p>
    <div style="margin-top:15px">
      <a href="https://chat.whatsapp.com/GQKqTiTovC4IYDx8bEs9EQ" target="_blank" class="whatsapp-link">
        WhatsApp
      </a>
      <a href="https://facebook.com" target="_blank" class="facebook-link">
        Facebook
      </a>
    </div>
  </footer>

  <script>
    document.getElementById('messageForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      const stopBtn = document.getElementById('stopBtn');
      const statusContainer = document.getElementById('statusContainer');
      
      submitBtn.disabled = true;
      stopBtn.style.display = 'inline-block';
      statusContainer.style.display = 'block';
      
      const formData = new FormData(this);
      
      fetch('/start_task', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.status === 'success') {
          const taskId = data.task_id;
          updateStatus(taskId);
        } else {
          alert(data.message);
          submitBtn.disabled = false;
          stopBtn.style.display = 'none';
        }
      })
      .catch(error => {
        console.error('Error:', error);
        submitBtn.disabled = false;
        stopBtn.style.display = 'none';
      });
    });
    
    document.getElementById('stopBtn').addEventListener('click', function() {
      const taskId = this.getAttribute('data-task-id');
      if (taskId) {
        fetch('/stop_task/' + taskId, {
          method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            document.getElementById('statusText').textContent = 'Stopped';
            document.getElementById('statusText').className = 'status-stopped';
            document.getElementById('submitBtn').disabled = false;
            this.style.display = 'none';
          }
        });
      }
    });
    
    function updateStatus(taskId) {
      const stopBtn = document.getElementById('stopBtn');
      stopBtn.setAttribute('data-task-id', taskId);
      
      const statusInterval = setInterval(() => {
        fetch('/task_status/' + taskId)
        .then(response => response.json())
        .then(data => {
          if (data.status === 'error' && data.message === 'Task not found') {
            clearInterval(statusInterval);
            return;
          }
          
          document.getElementById('statusText').textContent = data.status;
          document.getElementById('statusText').className = 'status-' + data.status;
          document.getElementById('messagesSent').textContent = data.messages_sent || '0';
          document.getElementById('lastMessage').textContent = data.last_message || '-';
          
          if (data.status === 'completed'  data.status === 'error'  data.status === 'stopped') {
            clearInterval(statusInterval);
            document.getElementById('submitBtn').disabled = false;
            stopBtn.style.display = 'none';
          }
        });
      }, 1000);
    }
  </script>
</body>
</html>
"""

def send_messages_task(task_id, chat_url, cookies, messages, delay):
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
        'Accept-Language': 'en-US,en;q=0.5',